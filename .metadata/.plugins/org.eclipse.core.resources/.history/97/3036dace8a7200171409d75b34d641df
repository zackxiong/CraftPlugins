package bot;

import java.io.File;
import java.io.IOException;

import org.apache.commons.configuration.PropertiesConfiguration;

import enterence.Enterence;
import gui.Gui;

public class MyConfig {
	File file = new File(Configs.propFileName);

	public void configInit(String[] args) throws Exception {
		/*
		 * FileOutputStream out = new FileOutputStream(Enterence.propFileName);
		 * Enterence.prop.putIfAbsent("sudoers", Enterence.sudoers);
		 * Enterence.prop.putIfAbsent("sudoPwd", Enterence.sudoPwd);
		 * Enterence.prop.putIfAbsent("server", Enterence.server);
		 * Enterence.prop.putIfAbsent("name", Enterence.name);
		 * Enterence.prop.putIfAbsent("channels", Enterence.channels);
		 * Enterence.prop.putIfAbsent("preffix", Enterence.preffix);
		 * Enterence.prop.putIfAbsent("sudoers", Enterence.sudoers);
		 * Enterence.prop.store(out, null); out.close();
		 */

		if (file.exists()) {
			Gui.log("Config file found, start loading");
			try {
				PropertiesConfiguration config = new PropertiesConfiguration(
						Enterence.propFileName);
				Configs.sudoers = config.getStringArray("sudoers");
				Configs.sudoPwd = (String) config.getProperty("sudoPwd");
				Configs.server = (String) config.getProperty("server");
				Configs.name = (String) config.getProperty("name");
				Configs.channels = (String[]) config.getProperty("channels");
				Configs.preffix = (String) config.getProperty("preffix");
				Configs.sudoers = (String[]) config.getProperty("sudoers");
				if(Configs.sudoers==null||Configs.sudoPwd==null){
					throw new Exception("File damaged");
				}
			} catch (Exception e) {
				Gui.displayException(e);
				Gui.log("Config file error: "+e.getMessage()+", creating one as default");

			}
		} else {
			Gui.log("Config file not found, creating one as default");
			createDefault();
		}

	}

	public void createDefault() throws Exception {
		file.createNewFile();
		PropertiesConfiguration config = new PropertiesConfiguration(
				Enterence.propFileName);
		config.addProperty("sudoers", Configs.sudoers);
		config.addProperty("sudoPwd", Configs.sudoPwd);
		config.addProperty("server", Configs.server);
		config.addProperty("name", Configs.name);
		config.addProperty("channels", Configs.channels);
		config.addProperty("preffix", Configs.preffix);
		config.addProperty("sudoers", Configs.sudoers);
		config.save();
	}
}
